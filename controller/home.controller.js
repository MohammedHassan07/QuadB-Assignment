const axios = require('axios')
const flatted = require('flatted');
const { PrismaClient } = require('@prisma/client')
const prisma = new PrismaClient()

const home = (req, res) => {

    res.render('../views/home')
}

const getData = async (req, res) => {

    try {
        
        // TODO:  fetch the data from the URL
        const URL = process.env.URL
        // const response = await axios.get(URL)

        // const inputJson = JSON.parse(flatted.stringify(response))

        // res.send(inputJson)

        // const keysData = [
        //     {
        //         "btcinr": "52",
        //         "xrpinr": "53",
        //         "ethinr": "54",
        //         "trxinr": "55",
        //         "eosinr": "56",
        //         "zilinr": "57",
        //         "batinr": "58",
        //         "zrxinr": "59",
        //         "reqinr": "60",
        //         "nulsinr": "61",
        //         "icxinr": "62",
        //         "omginr": "63",
        //         "iostinr": "64",
        //         "dentinr": "65",
        //         "hotinr": "66",
        //         "funinr": "67",
        //         "usdtinr": "68",
        //         "wrxinr": "69",
        //         "maticinr": "70",
        //         "bchinr": "71",
        //         "bnbinr": "72",
        //         "chzinr": "73",
        //         "oneinr": "74",
        //         "yfiinr": "75",
        //         "uniinr": "76",
        //         "linkinr": "77",
        //         "sxpinr": "78",
        //         "adainr": "79",
        //         "atominr": "80",
        //         "xlminr": "81",
        //         "fetinr": "82",
        //         "xeminr": "83",
        //         "zecinr": "84",
        //         "yfiiinr": "85",
        //         "dogeinr": "86",
        //         "dotinr": "87",
        //         "vetinr": "88",
        //         "crvinr": "89",
        //         "reninr": "90",
        //         "enjinr": "91",
        //         "manainr": "92",
        //         "hbarinr": "93",
        //         "umainr": "94",
        //         "chrinr": "95",
        //         "paxginr": "96",
        //         "1inchinr": "97",
        //         "etcinr": "98",
        //         "uftinr": "99",
        //         "dockinr": "100",
        //         "filinr": "101",
        //         "wininr": "102",
        //         "tkoinr": "103",
        //         "pushinr": "104",
        //         "avaxinr": "105",
        //         "xvginr": "106",
        //         "scinr": "107",
        //         "fttinr": "108",
        //         "dgbinr": "109",
        //         "cvcinr": "110",
        //         "cakeinr": "111",
        //         "ftminr": "112",
        //         "hntinr": "113",
        //         "ctsiinr": "114",
        //         "kmdinr": "115",
        //         "solinr": "116",
        //         "cotiinr": "117",
        //         "iotxinr": "118",
        //         "shibinr": "119",
        //         "rlcinr": "120",
        //         "trbinr": "121",
        //         "reefinr": "122",
        //         "icpinr": "123",
        //         "ontinr": "124",
        //         "ckbinr": "125",
        //         "pntinr": "126",
        //         "xvsinr": "127",
        //         "viteinr": "128",
        //         "dcrinr": "129",
        //         "mdxinr": "130",
        //         "phainr": "131",
        //         "runeinr": "132",
        //         "ogninr": "133",
        //         "datainr": "134",
        //         "ksminr": "135",
        //         "nkninr": "136",
        //         "balinr": "137",
        //         "snxinr": "138",
        //         "axsinr": "139",
        //         "celrinr": "140",
        //         "alphainr": "141",
        //         "compinr": "142",
        //         "aliceinr": "143",
        //         "egldinr": "144",
        //         "klayinr": "145",
        //         "sandinr": "146",
        //         "frontinr": "147",
        //         "lrcinr": "148",
        //         "stxinr": "149",
        //         "algoinr": "150",
        //         "pondinr": "151",
        //         "alpacainr": "152",
        //         "xecinr": "153",
        //         "ilvinr": "154",
        //         "mlninr": "155",
        //         "dydxinr": "156",
        //         "cfxinr": "157",
        //         "stptinr": "158",
        //         "radinr": "159",
        //         "burgerinr": "160",
        //         "roseinr": "161",
        //         "scrtinr": "162",
        //         "sysinr": "163",
        //         "agldinr": "164",
        //         "keyinr": "165",
        //         "rareinr": "166",
        //         "suninr": "167",
        //         "slpinr": "168",
        //         "auctioninr": "169",
        //         "atainr": "170",
        //         "oceaninr": "171",
        //         "superinr": "172",
        //         "betainr": "173",
        //         "waxpinr": "174",
        //         "arinr": "175",
        //         "sushiinr": "176",
        //         "mkrinr": "177",
        //         "qiinr": "178",
        //         "galainr": "179",
        //         "chessinr": "180",
        //         "tlminr": "181",
        //         "ensinr": "182",
        //         "ltoinr": "183",
        //         "ctxcinr": "184",
        //         "mboxinr": "185",
        //         "ookiinr": "186",
        //         "ampinr": "187",
        //         "voxelinr": "188",
        //         "powrinr": "189",
        //         "nearinr": "190",
        //         "antinr": "191",
        //         "ardrinr": "192",
        //         "farminr": "193",
        //         "grtinr": "194",
        //         "bttcinr": "195",
        //         "lazioinr": "196",
        //         "portoinr": "197",
        //         "santosinr": "198",
        //         "creaminr": "199",
        //         "glmrinr": "200",
        //         "bicoinr": "201",
        //         "xnoinr": "202",
        //         "spellinr": "203",
        //         "qntinr": "204",
        //         "duskinr": "205",
        //         "nmrinr": "206",
        //         "jasmyinr": "207",
        //         "tfuelinr": "208",
        //         "kncinr": "209",
        //         "dodoinr": "210",
        //         "achinr": "211",
        //         "idexinr": "212",
        //         "fidainr": "213",
        //         "darinr": "214",
        //         "celoinr": "215",
        //         "tinr": "216",
        //         "pyrinr": "217",
        //         "imxinr": "218",
        //         "api3inr": "219",
        //         "bakeinr": "220",
        //         "neoinr": "221",
        //         "alpineinr": "222",
        //         "astrinr": "223",
        //         "fluxinr": "224",
        //         "apeinr": "225",
        //         "kdainr": "226",
        //         "wooinr": "227",
        //         "acainr": "228",
        //         "alcxinr": "229",
        //         "ankrinr": "230",
        //         "oxtinr": "231",
        //         "multiinr": "232",
        //         "highinr": "233",
        //         "rndrinr": "234",
        //         "plainr": "235",
        //         "forinr": "236",
        //         "gmtinr": "237",
        //         "linainr": "238",
        //         "lokainr": "239",
        //         "bswinr": "240",
        //         "bondinr": "241",
        //         "mdtinr": "242",
        //         "reiinr": "243",
        //         "lptinr": "244",
        //         "ygginr": "245",
        //         "cityinr": "246",
        //         "twtinr": "247",
        //         "galinr": "248",
        //         "psginr": "249",
        //         "ghstinr": "250",
        //         "opinr": "251",
        //         "leverinr": "252",
        //         "ldoinr": "253",
        //         "polyxinr": "254",
        //         "usdcinr": "255",
        //         "hifiinr": "256",
        //         "gftinr": "257",
        //         "blurinr": "258",
        //         "bnxinr": "259",
        //         "flokiinr": "260",
        //         "briseinr": "261",
        //         "arbinr": "262",
        //         "injinr": "263",
        //         "srminr": "264",
        //         "pepeinr": "265",
        //         "vgxinr": "266",
        //         "idinr": "267",
        //         "bobinr": "268",
        //         "lqtyinr": "269",
        //         "comboinr": "270",
        //         "aaveinr": "271",
        //         "rsrinr": "272",
        //         "cosinr": "273",
        //         "avainr": "274",
        //         "bandinr": "275",
        //         "pendleinr": "276",
        //         "loominr": "277",
        //         "wldinr": "278",
        //         "quickinr": "279",
        //         "lovelyinr": "280",
        //         "vibinr": "281",
        //         "maskinr": "282",
        //         "adxinr": "283",
        //         "blzinr": "284",
        //         "pundixinr": "285",
        //         "sklinr": "286",
        //         "clvinr": "287",
        //         "stmxinr": "288",
        //         "audioinr": "289",
        //         "glminr": "290",
        //         "mtlinr": "291",
        //         "storjinr": "292",
        //         "perpinr": "293",
        //         "dexeinr": "294",
        //         "firoinr": "295",
        //         "bigtimeinr": "296",
        //         "memeinr": "297",
        //         "tokeninr": "298",
        //         "vicinr": "299",
        //         "beamxinr": "300",
        //         "bonkinr": "301",
        //         "jtoinr": "302",
        //         "ltcinr": "303",
        //         "dashinr": "304",
        //         "xrpbtc": "305",
        //         "trxbtc": "306",
        //         "ethbtc": "307",
        //         "zilbtc": "308",
        //         "batbtc": "309",
        //         "ltcbtc": "310",
        //         "qkcbtc": "311",
        //         "dashbtc": "312",
        //         "iostbtc": "313",
        //         "nulsbtc": "314",
        //         "omgbtc": "315",
        //         "reqbtc": "316",
        //         "sntbtc": "317",
        //         "thetabtc": "318",
        //         "zrxbtc": "319",
        //         "eosbtc": "320",
        //         "icxbtc": "321",
        //         "xlmbtc": "322",
        //         "fetbtc": "323",
        //         "celrbtc": "324",
        //         "maticbtc": "325",
        //         "adabtc": "326",
        //         "rvnbtc": "327",
        //         "xmrbtc": "328",
        //         "atombtc": "329",
        //         "bnbbtc": "330",
        //         "wrxbtc": "331",
        //         "stmxbtc": "332",
        //         "glmbtc": "333",
        //         "btcusdt": "334",
        //         "trxusdt": "335",
        //         "xrpusdt": "336",
        //         "eosusdt": "337",
        //         "ethusdt": "338",
        //         "icxusdt": "339",
        //         "ltcusdt": "340",
        //         "hotusdt": "341",
        //         "batusdt": "342",
        //         "dashusdt": "343",
        //         "qkcusdt": "344",
        //         "zilusdt": "345",
        //         "zrxusdt": "346",
        //         "bchusdt": "347",
        //         "bchsvusdt": "348",
        //         "omgusdt": "349",
        //         "dentusdt": "350",
        //         "iostusdt": "351",
        //         "funusdt": "352",
        //         "sntusdt": "353",
        //         "thetausdt": "354",
        //         "requsdt": "355",
        //         "xlmusdt": "356",
        //         "xtzusdt": "357",
        //         "fetusdt": "358",
        //         "tfuelusdt": "359",
        //         "celrusdt": "360",
        //         "maticusdt": "361",
        //         "adausdt": "362",
        //         "rvnusdt": "363",
        //         "xmrusdt": "364",
        //         "atomusdt": "365",
        //         "algousdt": "366",
        //         "linkusdt": "367",
        //         "qtumusdt": "368",
        //         "etcusdt": "369",
        //         "iotausdt": "370",
        //         "zecusdt": "371",
        //         "wavesusdt": "372",
        //         "ftmusdt": "373",
        //         "enjusdt": "374",
        //         "lskusdt": "375",
        //         "steemusdt": "376",
        //         "xvgusdt": "377",
        //         "loomusdt": "378",
        //         "manausdt": "379",
        //         "blzusdt": "380",
        //         "scusdt": "381",
        //         "xemusdt": "382",
        //         "btsusdt": "383",
        //         "ardrusdt": "384",
        //         "winusdt": "385",
        //         "bnbusdt": "386",
        //         "chzusdt": "387",
        //         "wrxusdt": "388",
        //         "kavausdt": "389",
        //         "ankrusdt": "390",
        //         "oneusdt": "391",
        //         "ognusdt": "392",
        //         "hiveusdt": "393",
        //         "fttusdt": "394",
        //         "bandusdt": "395",
        //         "jstusdt": "396",
        //         "ctsiusdt": "397",
        //         "chrusdt": "398",
        //         "stxusdt": "399",
        //         "stmxusdt": "400",
        //         "mdtusdt": "401",
        //         "ltousdt": "402",
        //         "lrcusdt": "403",
        //         "dogeusdt": "404",
        //         "neousdt": "405",
        //         "hbarusdt": "406",
        //         "storjusdt": "407",
        //         "compusdt": "408",
        //         "cotiusdt": "409",
        //         "dgbusdt": "410",
        //         "snxusdt": "411",
        //         "renusdt": "412",
        //         "sxpusdt": "413",
        //         "mkrusdt": "414",
        //         "daiusdt": "415",
        //         "avausdt": "416",
        //         "balusdt": "417",
        //         "srmusdt": "418",
        //         "egldusdt": "419",
        //         "cosusdt": "420",
        //         "dotusdt": "421",
        //         "yfiusdt": "422",
        //         "iotxusdt": "423",
        //         "sandusdt": "424",
        //         "uniusdt": "425",
        //         "datausdt": "426",
        //         "paxgusdt": "427",
        //         "creamusdt": "428",
        //         "swrvusdt": "429",
        //         "umausdt": "430",
        //         "diausdt": "431",
        //         "ksmusdt": "432",
        //         "yfiiusdt": "433",
        //         "trbusdt": "434",
        //         "adxusdt": "435",
        //         "aaveusdt": "436",
        //         "filusdt": "437",
        //         "crvusdt": "438",
        //         "nearusdt": "439",
        //         "hntusdt": "440",
        //         "avaxusdt": "441",
        //         "oxtusdt": "442",
        //         "dockusdt": "443",
        //         "duskusdt": "444",
        //         "wtcusdt": "445",
        //         "perlusdt": "446",
        //         "injusdt": "447",
        //         "vetusdt": "448",
        //         "mtlusdt": "449",
        //         "frontusdt": "450",
        //         "glmusdt": "451",
        //         "sushiusdt": "452",
        //         "firousdt": "453",
        //         "dexeusdt": "454",
        //         "grtusdt": "455",
        //         "bntusdt": "456",
        //         "rsrusdt": "457",
        //         "1inchusdt": "458",
        //         "uftusdt": "459",
        //         "pundixusdt": "460",
        //         "ckbusdt": "461",
        //         "vibusdt": "462",
        //         "tkousdt": "463",
        //         "pushusdt": "464",
        //         "cvcusdt": "465",
        //         "cakeusdt": "466",
        //         "kmdusdt": "467",
        //         "solusdt": "468",
        //         "shibusdt": "469",
        //         "rlcusdt": "470",
        //         "reefusdt": "471",
        //         "icpusdt": "472",
        //         "ontusdt": "473",
        //         "pntusdt": "474",
        //         "xvsusdt": "475",
        //         "viteusdt": "476",
        //         "dcrusdt": "477",
        //         "mdxusdt": "478",
        //         "phausdt": "479",
        //         "runeusdt": "480",
        //         "nknusdt": "481",
        //         "axsusdt": "482",
        //         "alphausdt": "483",
        //         "aliceusdt": "484",
        //         "klayusdt": "485",
        //         "xecusdt": "486",
        //         "perpusdt": "487",
        //         "qntusdt": "488",
        //         "flowusdt": "489",
        //         "vgxusdt": "490",
        //         "arusdt": "491",
        //         "dodousdt": "492",
        //         "minausdt": "493",
        //         "clvusdt": "494",
        //         "bakeusdt": "495",
        //         "alpacausdt": "496",
        //         "gnousdt": "497",
        //         "tlmusdt": "498",
        //         "audiousdt": "499",
        //         "sklusdt": "500",
        //         "mboxusdt": "501",
        //         "degousdt": "502",
        //         "galausdt": "503",
        //         "maskusdt": "504",
        //         "pondusdt": "505",
        //         "ilvusdt": "506",
        //         "mlnusdt": "507",
        //         "dydxusdt": "508",
        //         "cfxusdt": "509",
        //         "stptusdt": "510",
        //         "radusdt": "511",
        //         "burgerusdt": "512",
        //         "roseusdt": "513",
        //         "scrtusdt": "514",
        //         "sysusdt": "515",
        //         "agldusdt": "516",
        //         "keyusdt": "517",
        //         "rareusdt": "518",
        //         "sunusdt": "519",
        //         "slpusdt": "520",
        //         "auctionusdt": "521",
        //         "atausdt": "522",
        //         "oceanusdt": "523",
        //         "superusdt": "524",
        //         "betausdt": "525",
        //         "waxpusdt": "526",
        //         "qiusdt": "527",
        //         "chessusdt": "528",
        //         "ensusdt": "529",
        //         "nulsusdt": "530",
        //         "ctxcusdt": "531",
        //         "ookiusdt": "532",
        //         "ampusdt": "533",
        //         "voxelusdt": "534",
        //         "powrusdt": "535",
        //         "antusdt": "536",
        //         "farmusdt": "537",
        //         "bttcusdt": "538",
        //         "laziousdt": "539",
        //         "portousdt": "540",
        //         "santosusdt": "541",
        //         "glmrusdt": "542",
        //         "bicousdt": "543",
        //         "xnousdt": "544",
        //         "spellusdt": "545",
        //         "achusdt": "546",
        //         "nmrusdt": "547",
        //         "jasmyusdt": "548",
        //         "kncusdt": "549",
        //         "idexusdt": "550",
        //         "fidausdt": "551",
        //         "darusdt": "552",
        //         "celousdt": "553",
        //         "tusdt": "554",
        //         "pyrusdt": "555",
        //         "imxusdt": "556",
        //         "api3usdt": "557",
        //         "alpineusdt": "558",
        //         "astrusdt": "559",
        //         "fluxusdt": "560",
        //         "apeusdt": "561",
        //         "kdausdt": "562",
        //         "woousdt": "563",
        //         "acausdt": "564",
        //         "alcxusdt": "565",
        //         "multiusdt": "566",
        //         "highusdt": "567",
        //         "rndrusdt": "568",
        //         "plausdt": "569",
        //         "forusdt": "570",
        //         "gmtusdt": "571",
        //         "linausdt": "572",
        //         "lokausdt": "573",
        //         "bswusdt": "574",
        //         "bondusdt": "575",
        //         "reiusdt": "576",
        //         "lptusdt": "577",
        //         "yggusdt": "578",
        //         "cityusdt": "579",
        //         "twtusdt": "580",
        //         "psgusdt": "581",
        //         "ghstusdt": "582",
        //         "galusdt": "583",
        //         "opusdt": "584",
        //         "leverusdt": "585",
        //         "ldousdt": "586",
        //         "polyxusdt": "587",
        //         "gftusdt": "588",
        //         "blurusdt": "589",
        //         "bnxusdt": "590",
        //         "flokiusdt": "591",
        //         "briseusdt": "592",
        //         "arbusdt": "593",
        //         "pepeusdt": "594",
        //         "idusdt": "595",
        //         "bobusdt": "596",
        //         "lqtyusdt": "597",
        //         "combousdt": "598",
        //         "pendleusdt": "599",
        //         "wldusdt": "600",
        //         "quickusdt": "601",
        //         "lovelyusdt": "602",
        //         "bigtimeusdt": "603",
        //         "memeusdt": "604",
        //         "tokenusdt": "605",
        //         "vicusdt": "606",
        //         "beamxusdt": "607",
        //         "bonkusdt": "608",
        //         "jtousdt": "609",
        //         "ethwrx": "610",
        //         "xrpwrx": "611",
        //         "yfiwrx": "612",
        //         "bnbwrx": "613",
        //         "trxwrx": "614",
        //         "eoswrx": "615",
        //         "ltcwrx": "616",
        //         "linkwrx": "617",
        //         "enjwrx": "618",
        //         "dogewrx": "619",
        //         "maticwrx": "620",
        //         "adawrx": "621",
        //         "batwrx": "622",
        //         "shibwrx": "623",
        //         "1inchwrx": "624",
        //         "dockwrx": "625",
        //         "runewrx": "626",
        //         "chrwrx": "627",
        //         "yfiiwrx": "628"
        //     }
        // ];

        // const transformedKeysData = {}
        // keysData.forEach(obj => {

        //     Object.keys(obj).forEach(key => {
        //         const value = obj[key]

        //         const [base_unit] = key.toLowerCase().match(/[a-z]+|[^a-z]+/gi)

        //         const newKey = `${base_unit}`
        //         transformedKeysData[newKey] = {
        //             base_unit,
        //             quote_unit,
        //             value,
        //             low,
        //             high,
        //             last,
        //             type,
        //             open,
        //             volume,
        //             sell,
        //             buy,
        //             at,
        //             name
        //         }
        //     })
        // })
        // res.status(200).send(transformedKeysData)


        // TODO: sotre the data into database
        // const cryptoData = await prisma.cryptoPair.create({

        //     baseUnit: "btc",
        //     quoteUnit: "inr",
        //     low: 3400000.0,
        //     high: 3585532.0,
        //     last: 3551000.0,
        //     type: "SPOT",
        //     open: 3400000,
        //     volume: 6.85086,
        //     sell: 3560000.0,
        //     buy: 3551100.0,
        //     at: 1706097120,
        //     name: "BTC/INR",
        // })

        // console.log(cryptoData)
        
        // send the data to the client
        res.status(200).json({message: 'success'})

    } catch (error) {
        console.log('homeController -> ', error)
        res.status(500).json({ message: 'Internal Server Error' })

    } finally {

        await prisma.$disconnect()
    }
}

module.exports = {

    home, getData
}